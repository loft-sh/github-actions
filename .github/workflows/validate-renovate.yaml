name: Validate Renovate Config

on:
  workflow_call:

jobs:
  validate:
    name: Validate Renovate configuration
    runs-on: ubuntu-latest
    permissions:
      contents: read
    steps:
      - name: Checkout
        uses: actions/checkout@de0fac2e4500dabe0009e67214ff5f5447ce83dd # v6.0.2
        with:
          persist-credentials: false

      - name: Get changed Renovate config files
        id: changed-files
        uses: tj-actions/changed-files@7dee1b0c1557f278e5c7dc244927139d78c0e22a # v47.0.4
        with:
          files: |
            renovate.json
            renovate.json5
            .renovaterc
            .renovaterc.json
            .github/renovate.json
            .github/renovate.json5

      - name: Validate Renovate config
        if: steps.changed-files.outputs.any_changed == 'true'
        env:
          LOG_LEVEL: warn
        run: npx --yes --package renovate -- renovate-config-validator

      - name: No Renovate config files changed
        if: steps.changed-files.outputs.any_changed != 'true'
        run: echo "No Renovate config files were changed in this PR. Skipping validation."
