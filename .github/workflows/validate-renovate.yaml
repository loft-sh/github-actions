name: Validate Renovate Config

on:
  workflow_call:

jobs:
  validate:
    name: Validate Renovate configuration
    runs-on: ubuntu-latest
    permissions:
      contents: read
      pull-requests: read
    steps:
      - name: Checkout
        uses: actions/checkout@de0fac2e4500dabe0009e67214ff5f5447ce83dd # v6.0.2
        with:
          persist-credentials: false

      - name: Get changed Renovate config files
        id: changed-files
        uses: dorny/paths-filter@de90cc6fb38fc0963ad72b210f1f284cd68cea36 # v3.0.2
        with:
          filters: |
            renovate:
              - 'renovate.json'
              - 'renovate.json5'
              - '.renovaterc'
              - '.renovaterc.json'
              - '.github/renovate.json'
              - '.github/renovate.json5'

      - name: Validate Renovate config
        if: steps.changed-files.outputs.renovate == 'true'
        env:
          LOG_LEVEL: warn
        run: npx --yes --package renovate -- renovate-config-validator

      - name: No Renovate config files changed
        if: steps.changed-files.outputs.renovate != 'true'
        run: echo "No Renovate config files were changed in this PR. Skipping validation."
